name: Issue Auto Labeler

on:
  issues:
    types: [opened, reopened, edited]

jobs:
  label:
    runs-on: ubuntu-latest
    steps:
      - name: Auto label issue
        uses: actions/github-script@v7
        with:
          script: |
            const issueNumber = context.issue.number;
            const title = context.payload.issue.title.toLowerCase();
            const body = (context.payload.issue.body || '').toLowerCase();
            const author = context.payload.issue.user.login;

            const labels = [];

            // 1. ì´ìŠˆ íƒ€ì…ë³„ ë¼ë²¨ë§
            if (title.includes('bug') || title.includes('error') || title.includes('broken') ||
                title.includes('fail') || body.includes('bug') || body.includes('error')) {
              labels.push('bug');
            }

            if (title.includes('feature') || title.includes('enhancement') || title.includes('improvement') ||
                title.includes('add') || body.includes('feature') || body.includes('enhancement')) {
              labels.push('feature');
            }

            if (title.includes('question') || title.includes('help') || title.includes('how') ||
                title.includes('?') || body.includes('question') || body.includes('help')) {
              labels.push('question');
            }

            if (title.includes('doc') || title.includes('readme') || title.includes('document') ||
                body.includes('documentation') || body.includes('readme')) {
              labels.push('documentation');
            }

            // 2. ìš°ì„ ìˆœìœ„ ë¼ë²¨ë§
            if (title.includes('urgent') || title.includes('critical') || title.includes('hotfix') ||
                title.includes('asap') || body.includes('urgent') || body.includes('critical')) {
              labels.push('priority: high');
            } else if (title.includes('important') || title.includes('soon') ||
                       body.includes('important') || body.includes('soon')) {
              labels.push('priority: medium');
            } else {
              labels.push('priority: low');
            }

            // 3. ì»´í¬ë„ŒíŠ¸ë³„ ë¼ë²¨ë§
            if (title.includes('backend') || title.includes('api') || title.includes('server') ||
                title.includes('fastapi') || body.includes('backend') || body.includes('api')) {
              labels.push('backend');
            }

            if (title.includes('frontend') || title.includes('ui') || title.includes('streamlit') ||
                title.includes('interface') || body.includes('frontend') || body.includes('streamlit')) {
              labels.push('frontend');
            }

            if (title.includes('test') || title.includes('testing') || title.includes('pytest') ||
                body.includes('test') || body.includes('testing')) {
              labels.push('testing');
            }

            if (title.includes('config') || title.includes('setup') || title.includes('install') ||
                title.includes('deploy') || body.includes('configuration') || body.includes('deployment')) {
              labels.push('configuration');
            }

            if (title.includes('database') || title.includes('db') || title.includes('sql') ||
                body.includes('database') || body.includes('data')) {
              labels.push('database');
            }

            if (title.includes('security') || title.includes('auth') || title.includes('permission') ||
                body.includes('security') || body.includes('authentication')) {
              labels.push('security');
            }

            if (title.includes('performance') || title.includes('slow') || title.includes('speed') ||
                title.includes('optimization') || body.includes('performance') || body.includes('slow')) {
              labels.push('performance');
            }

            // 4. ë‚œì´ë„ë³„ ë¼ë²¨ë§
            if (title.includes('simple') || title.includes('easy') || title.includes('minor') ||
                body.includes('simple') || body.includes('easy')) {
              labels.push('difficulty: easy');
            } else if (title.includes('complex') || title.includes('hard') || title.includes('difficult') ||
                       body.includes('complex') || body.includes('difficult')) {
              labels.push('difficulty: hard');
            } else {
              labels.push('difficulty: medium');
            }

            // 5. ìƒíƒœ ë¼ë²¨ (ì´ˆê¸° ìƒíƒœ)
            labels.push('status: todo');

            // 6. íŠ¹ë³„ ìƒí™© ë¼ë²¨ë§
            if (title.includes('duplicate') || body.includes('duplicate')) {
              labels.push('duplicate');
            }

            if (title.includes('wontfix') || body.includes('wontfix')) {
              labels.push('wontfix');
            }

            if (title.includes('good first issue') || title.includes('beginner') ||
                body.includes('good first issue') || body.includes('beginner')) {
              labels.push('good first issue');
            }

            if (title.includes('help wanted') || body.includes('help wanted')) {
              labels.push('help wanted');
            }

            // 7. í”Œë«í¼ë³„ ë¼ë²¨ë§
            if (title.includes('windows') || body.includes('windows')) {
              labels.push('platform: windows');
            }

            if (title.includes('linux') || body.includes('linux')) {
              labels.push('platform: linux');
            }

            if (title.includes('mac') || title.includes('macos') || body.includes('mac')) {
              labels.push('platform: mac');
            }

            // 8. ì–¸ì–´ë³„ ë¼ë²¨ë§
            if (title.includes('python') || body.includes('python')) {
              labels.push('language: python');
            }

            if (title.includes('javascript') || title.includes('js') || body.includes('javascript')) {
              labels.push('language: javascript');
            }

            if (title.includes('html') || title.includes('css') || body.includes('html') || body.includes('css')) {
              labels.push('language: web');
            }

            // 9. ì´ìŠˆ í¬ê¸° ì¶”ì • (ì œëª©ê³¼ ë³¸ë¬¸ ê¸¸ì´ ê¸°ë°˜)
            const totalLength = title.length + body.length;
            if (totalLength < 100) {
              labels.push('size: small');
            } else if (totalLength < 500) {
              labels.push('size: medium');
            } else {
              labels.push('size: large');
            }

            // ì¤‘ë³µ ì œê±°
            const uniqueLabels = [...new Set(labels)];

            // ë¼ë²¨ ì ìš©
            if (uniqueLabels.length > 0) {
              await github.rest.issues.setLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issueNumber,
                labels: uniqueLabels
              });
              
              // ë¼ë²¨ë§ ì™„ë£Œ ëŒ“ê¸€
              const comment = `### ğŸ·ï¸ ìë™ ë¼ë²¨ë§ ì™„ë£Œ
              
              ë‹¤ìŒ ë¼ë²¨ì´ ìë™ìœ¼ë¡œ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤:
              ${uniqueLabels.map(label => `\`${label}\``).join(', ')}
              
              ### ğŸ“Š ë¶„ì„ ê²°ê³¼
              
              **ì´ìŠˆ íƒ€ì…**: ${uniqueLabels.filter(l => ['bug', 'feature', 'question', 'documentation'].includes(l)).join(', ') || 'ì¼ë°˜'}
              
              **ìš°ì„ ìˆœìœ„**: ${uniqueLabels.find(l => l.startsWith('priority:'))?.replace('priority: ', '') || 'ë‚®ìŒ'}
              
              **ê´€ë ¨ ì»´í¬ë„ŒíŠ¸**: ${uniqueLabels.filter(l => ['backend', 'frontend', 'testing', 'configuration', 'database', 'security'].includes(l)).join(', ') || 'ì—†ìŒ'}
              
              **ì˜ˆìƒ ë‚œì´ë„**: ${uniqueLabels.find(l => l.startsWith('difficulty:'))?.replace('difficulty: ', '') || 'ë³´í†µ'}
              
              **ì´ìŠˆ í¬ê¸°**: ${uniqueLabels.find(l => l.startsWith('size:'))?.replace('size: ', '') || 'ë³´í†µ'}
              
              ### ğŸ”„ ë¼ë²¨ ì„¤ëª…
              
              **íƒ€ì… ë¼ë²¨**:
              - \`bug\`: ë²„ê·¸ ì‹ ê³  ë° ìˆ˜ì •
              - \`feature\`: ìƒˆë¡œìš´ ê¸°ëŠ¥ ìš”ì²­
              - \`question\`: ì§ˆë¬¸ ë° ë„ì›€ ìš”ì²­
              - \`documentation\`: ë¬¸ì„œ ê´€ë ¨
              
              **ìš°ì„ ìˆœìœ„ ë¼ë²¨**:
              - \`priority: high\`: ê¸´ê¸‰ ì²˜ë¦¬ í•„ìš”
              - \`priority: medium\`: ì¤‘ê°„ ìš°ì„ ìˆœìœ„
              - \`priority: low\`: ë‚®ì€ ìš°ì„ ìˆœìœ„
              
              **ìƒíƒœ ë¼ë²¨**:
              - \`status: todo\`: í•  ì¼ (ì´ˆê¸° ìƒíƒœ)
              - \`status: in-progress\`: ì§„í–‰ ì¤‘
              - \`status: review\`: ê²€í†  ì¤‘
              - \`status: done\`: ì™„ë£Œ
              
              ### ğŸ“ ë¼ë²¨ ìˆ˜ì •
              ìë™ìœ¼ë¡œ ì ìš©ëœ ë¼ë²¨ì´ ë¶€ì •í™•í•œ ê²½ìš°, ì–¸ì œë“  ìˆ˜ë™ìœ¼ë¡œ ìˆ˜ì •í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
              
              ---
              *ë¼ë²¨ì´ ìë™ìœ¼ë¡œ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤. í•„ìš”ì‹œ ìˆ˜ë™ìœ¼ë¡œ ìˆ˜ì • ê°€ëŠ¥í•©ë‹ˆë‹¤.*`;
              
              await github.rest.issues.createComment({
                issue_number: issueNumber,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: comment
              });
            }
